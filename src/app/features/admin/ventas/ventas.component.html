

<main class="main">
 


<!-- ventas.component.html - Versión simplificada -->
<div class="container-fluid">
  <h2>Historial de Ventas</h2>
  
  <table class="table table-bordered table-striped">
    <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th>Usuario</th>
        <th>Método de Pago</th>
        <th>Total</th>
        <th>Fecha</th>
        <th>Detalles</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let venta of ventas">
       
          <tr *ngFor="let venta of ventas">
                  <td>{{ venta.id }}</td>
                  <td>
                    {{ venta.usuarioEmail }}
                    <small class="text-muted d-block">ID: {{ venta.userId }}</small>
                  </td>
                  <td>
                    {{ venta.metodoPagoNombre }}
                    <small class="text-muted d-block">ID: {{ venta.metodoPagoId }}</small>
                  </td>

        <td>{{ venta.total | currency:'PEN' }}</td>
        <td>{{ venta.fechaVenta | date:'short' }}</td>
        <td>
          <div *ngIf="venta.detalles && venta.detalles.length > 0; else noDetalles">
            <ul>
              <li *ngFor="let det of venta.detalles">
                <strong>Producto:</strong> {{ det.nombreProducto }} <br />
                <strong>Cantidad:</strong> {{ det.cantidad }} <br />
                <strong>Precio unitario:</strong> S/. {{ det.precio }}
              </li>
            </ul>
          </div>
          <ng-template #noDetalles>
            <em>Sin detalles</em>
          </ng-template>
        </td>
        <td>
          <button 
            class="btn btn-sm btn-primary" 
            (click)="verDetalleCompleto(venta)"
            title="Ver más detalles">
            <i class="fas fa-eye"></i> Ver
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Sección de detalle completo (se muestra cuando se selecciona una venta) -->
  <div *ngIf="ventaSeleccionada" class="card mt-4">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h4>Detalles de Venta #{{ ventaSeleccionada.id }}</h4>
      <button class="btn btn-sm btn-secondary" (click)="cerrarDetalle()">
        <i class="fas fa-times"></i> Cerrar
      </button>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <h5>Información General</h5>
          <p><strong>Cliente:</strong> {{ ventaSeleccionada.usuarioEmail }}</p>
          <p><strong>Método de Pago:</strong> {{ ventaSeleccionada.metodoPagoNombre }}</p>
          <p><strong>Total:</strong> {{ ventaSeleccionada.total | currency:'PEN' }}</p>
          <p><strong>Fecha:</strong> {{ ventaSeleccionada.fechaVenta | date:'dd/MM/yyyy HH:mm' }}</p>
          
        </div>
        <div class="col-md-6">
          <h5>Productos:</h5>
          <div class="table-responsive">
            <table class="table table-sm">
              <thead>
                <tr>
                  <th>Producto</th>
                  <th>Cantidad</th>
                  <th>Precio Unitario</th>
                  <th>Subtotal</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let det of ventaSeleccionada.detalles">
                  <td>{{ det.nombreProducto }}</td>
                  <td>{{ det.cantidad }}</td>
                  <td>S/. {{ det.precio | number:'1.2-2' }}</td>
                  <td>S/. {{ (det.cantidad * det.precio) | number:'1.2-2' }}</td>
                </tr>
              </tbody>
              <tfoot>
                <tr class="table-info">
                  <td colspan="3"><strong>Total:</strong></td>
                  <td><strong>{{ ventaSeleccionada.total | currency:'PEN' }}</strong></td>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>
      </div>
      
      <div class="mt-3">
        <button class="btn btn-success me-2" (click)="imprimirVenta(ventaSeleccionada)">
          <i class="fas fa-print"></i> Imprimir
        </button>
        <button class="btn btn-info" (click)="exportarVenta(ventaSeleccionada)">
          <i class="fas fa-download"></i> Exportar CSV
        </button>
      </div>
    </div>
  </div>
</div>


</main>